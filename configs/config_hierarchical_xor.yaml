# config_hierarchical_xor.yaml
experiment_name: 08_12/hierarchical_xor_run_1_shuffle
seed: 123
device: cuda  # Use GPU (H100) - set to 'cpu' if no GPU available

dataset:
  name: hierarchical_xor          # <--- use new hierarchical XOR dataset
  # hierarchy shape
  L: 3
  m: 2
  s: 4
  # sizes (can be a list to train on multiple sizes)
  n_train: [20000,10000] #[500,100,5000,1000,2500,7500,10000]   #[128, 512, 1024, 2048, 3072, 5120, 7168, 8192, 12288, 16384, 18432, 22528, 28672, 32768]0
  n_val: 2000
  n_test: 5000
  # nuisance
  distractor_dims: 80
  # Alpha parameter: multiplies output labels (can be a list to sweep over values)
  # e.g., alpha=5 means labels -1,+1 become -5,+5
  alpha: [1.0, 5.0]  # Can be a single value or list for sweeping
  # Randomly shuffle labels to break the relationship between inputs and labels
  # When true, labels are randomly reassigned, making the task impossible to learn
  random_labels: true  # Set to true to destroy input-target correlation

model:
  widths: [512, 512, 512,512]
  activation: relu  # Options: relu, gelu, tanh, sigmoid, elu
  bias: false

training:
  algo: sgd  # Only 'sgd' is supported
  epochs: 30000
  batch_size: 4096
  lr_w: 1e-4  # Learning rate
  loss: mse
  # Optimizer: "sgd" or "adam" (can be a list to sweep over both)
  optimizer: ["sgd", "adam"]  # Options: "sgd" or "adam"

logging:
  eval_every_cycle: true
  save_checkpoints: true
  save_model: false  # Set to false to skip saving model files (saves disk space)
  # Computation frequency controls (for speed optimization)
  # Enable expensive path analysis stack (kernel eigs, plots, dominant paths)
  enable_path_analysis: true
  # Enable/disable Path Sankey diagram (nn_graph_paths) - can be very expensive
  # When false, skips: mean transmittance computation, path feature computation, alignment, graph drawing
  enable_nn_graph_paths: false
  # Effective rank SVDs are expensive: run every 200 epochs
  effective_rank_every_n_epochs: 400
  # Path kernel metrics (SVD on large matrices): run every 200 epochs
  path_kernel_metrics_every_n_epochs: 400
  # Full path analysis (plots, dominant k paths): run every 200 epochs
  path_analysis_every_n_epochs: 400
  # Gate-state counting: run every 200 epochs
  gate_states_every_n_epochs: 500
  # Number of samples to use for gate state computation (default: 2500)
  gate_states_max_samples: 2500
  # Kernel computation settings (tuned for H100)
  path_kernel_block_size: 4096
  path_kernel_power_iters: 12
